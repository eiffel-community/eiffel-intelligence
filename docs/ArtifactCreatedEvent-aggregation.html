<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 at 2018-12-11 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20181211" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Eiffel Intelligence &#x2013; ArtifactCreatedEvent Aggregation</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.5.min.js"></script>

          
                      </head>
        <body class="topBarEnabled">
          
                
                    
                

    <div id="topbar" class="navbar navbar-fixed-top navbar-inverse">
      <div class="navbar-inner">
                <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
                
                                                                                                    <a class="brand" href="./" >

                                
                                    Eiffel Intelligence
                
                </a>
                    
                                <ul class="nav">
                          <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Overview <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="index.html"  title="Home">Home</a>
</li>
                  
                      <li>      <a href="Configuration.html"  title="Configuration">Configuration</a>
</li>
                  
                      <li>      <a href="Running-Eiffel-Intelligence.html"  title="Running Eiffel Intelligence">Running Eiffel Intelligence</a>
</li>
                  
                      <li class="dropdown-submenu">
                                      <a href="REST-API.html"  title="REST API">REST API</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="Query.html"  title="Query">Query</a>
</li>
                                  <li>      <a href="Running-rules-on-objects.html"  title="Running rules on objects">Running rules on objects</a>
</li>
                                  <li>      <a href="Authentication.html"  title="Authentication">Authentication</a>
</li>
                                  <li>      <a href="Subscription-API.html"  title="Subscriptions">Subscriptions</a>
</li>
                                  <li>      <a href="Download-Files.html"  title="Download files">Download files</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="Subscriptions.html"  title="Subscriptions">Subscriptions</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="REST-POST-notification.html"  title="REST POST notification">REST POST notification</a>
</li>
                                  <li>      <a href="Email-notification.html"  title="Email notification">Email notification</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="Rules.html"  title="Rules">Rules</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="MergeResolverRules.html"  title="Merge Resolver Rules">Merge Resolver Rules</a>
</li>
                                  <li>      <a href="History-rules.html"  title="History Rules">History Rules</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="Step-by-Step-Aggregation.html"  title="Step-by-step aggregation">Step-by-step aggregation</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="ArtifactCreatedEvent-aggregation.html"  title="EiffelArtifactCreatedEvent aggregation">EiffelArtifactCreatedEvent aggregation</a>
</li>
                                  <li>      <a href="EiffelTestCaseTriggeredEvent-Aggregation.html"  title="EiffelTestCaseTriggeredEvent aggregation">EiffelTestCaseTriggeredEvent aggregation</a>
</li>
                                  <li>      <a href="EiffelTestCaseStartedEvent-aggregation.html"  title="EiffelTestCaseStartedEvent aggregation">EiffelTestCaseStartedEvent aggregation</a>
</li>
                                  <li>      <a href="EiffelTestCaseFinishedEvent-aggregation.html"  title="EiffelTestCaseFinishedEvent aggregation">EiffelTestCaseFinishedEvent aggregation</a>
</li>
                                  <li>      <a href="EiffelArtifactPublishedEvent-Aggregation.html"  title="EiffelArtifactPublishedEvent aggregation">EiffelArtifactPublishedEvent aggregation</a>
</li>
                                  <li>      <a href="EiffelConfidenceLevelModifiedEvent-Aggregation.html"  title="EiffelConfidenceLevelModifiedEvent">EiffelConfidenceLevelModifiedEvent</a>
</li>
                                  <li>      <a href="Step-by-Step-Subscription-Notification.html"  title="Step-by-step subscription notification">Step-by-step subscription notification</a>
</li>
                              </ul>
            </li>
                  
                      <li>      <a href="Known-limitations.html"  title="Known limitations">Known limitations</a>
</li>
                          </ul>
      </li>
                  </ul>
          
          
          
                   
                      </div>
          
        </div>
      </div>
    </div>
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Eiffel Intelligence</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                              <li class="">
                    <a href="index.html" title="Home">
        Home</a>
                    <span class="divider">-</span>
      </li>
        <li class="active ">ArtifactCreatedEvent Aggregation</li>
        
              
                  <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2018-12-11</li>
              <li id="projectVersion" class="pull-right">
                    Version: 0.0.18
        </li>
            
                            </ul>
      </div>

                  
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                    <li class="nav-header">Overview</li>
                              
      <li>
  
                          <a href="index.html" title="Home">
          <span class="none"></span>
        Home</a>
            </li>
                
      <li>
  
                          <a href="Configuration.html" title="Configuration">
          <span class="none"></span>
        Configuration</a>
            </li>
                
      <li>
  
                          <a href="Running-Eiffel-Intelligence.html" title="Running Eiffel Intelligence">
          <span class="none"></span>
        Running Eiffel Intelligence</a>
            </li>
                                                                                                                                          
      <li>
  
                          <a href="REST-API.html" title="REST API">
          <span class="icon-chevron-right"></span>
        REST API</a>
                  </li>
                                                                                    
      <li>
  
                          <a href="Subscriptions.html" title="Subscriptions">
          <span class="icon-chevron-right"></span>
        Subscriptions</a>
                  </li>
                                                                                    
      <li>
  
                          <a href="Rules.html" title="Rules">
          <span class="icon-chevron-right"></span>
        Rules</a>
                  </li>
                                                                                                                                                                                        
      <li>
  
                          <a href="Step-by-Step-Aggregation.html" title="Step-by-step aggregation">
          <span class="icon-chevron-down"></span>
        Step-by-step aggregation</a>
                    <ul class="nav nav-list">
                    
      <li class="active">
  
            <a href="#"><span class="none"></span>EiffelArtifactCreatedEvent aggregation</a>
          </li>
                    
      <li>
  
                          <a href="EiffelTestCaseTriggeredEvent-Aggregation.html" title="EiffelTestCaseTriggeredEvent aggregation">
          <span class="none"></span>
        EiffelTestCaseTriggeredEvent aggregation</a>
            </li>
                    
      <li>
  
                          <a href="EiffelTestCaseStartedEvent-aggregation.html" title="EiffelTestCaseStartedEvent aggregation">
          <span class="none"></span>
        EiffelTestCaseStartedEvent aggregation</a>
            </li>
                    
      <li>
  
                          <a href="EiffelTestCaseFinishedEvent-aggregation.html" title="EiffelTestCaseFinishedEvent aggregation">
          <span class="none"></span>
        EiffelTestCaseFinishedEvent aggregation</a>
            </li>
                    
      <li>
  
                          <a href="EiffelArtifactPublishedEvent-Aggregation.html" title="EiffelArtifactPublishedEvent aggregation">
          <span class="none"></span>
        EiffelArtifactPublishedEvent aggregation</a>
            </li>
                    
      <li>
  
                          <a href="EiffelConfidenceLevelModifiedEvent-Aggregation.html" title="EiffelConfidenceLevelModifiedEvent">
          <span class="none"></span>
        EiffelConfidenceLevelModifiedEvent</a>
            </li>
                    
      <li>
  
                          <a href="Step-by-Step-Subscription-Notification.html" title="Step-by-step subscription notification">
          <span class="none"></span>
        Step-by-step subscription notification</a>
            </li>
              </ul>
        </li>
                
      <li>
  
                          <a href="Known-limitations.html" title="Known limitations">
          <span class="none"></span>
        Known limitations</a>
            </li>
            </ul>
              
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                        
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>ArtifactCreatedEvent Aggregation</h1>
<p>Suppose, we publish an &#x201c;EiffelArtifactCreatedEvent&#x201d; (given below) on the message bus.</p>

<div>
<div>
<pre class="source">{
&quot;meta&quot;: {
    &quot;time&quot;: 1473177136433,
    &quot;source&quot;: {
        &quot;domainId&quot;: &quot;example.domain&quot;
    },
    &quot;type&quot;: &quot;EiffelArtifactCreatedEvent&quot;,
    &quot;id&quot;: &quot;ccce572c-c364-441e-abc9-b62fed080ca2&quot;,
    &quot;version&quot;: &quot;1.0.0&quot;
},
&quot;links&quot;: [{
        &quot;target&quot;: &quot;23df3bd2-c620-42ce-80ba-b7ba6551c9f9&quot;,
        &quot;type&quot;: &quot;COMPOSITION&quot;
    },
    {
        &quot;target&quot;: &quot;9ace5eea-3547-45f6-be4d-25b43d87e6dc&quot;,
        &quot;type&quot;: &quot;ENVIRONMENT&quot;
    },
    {
        &quot;target&quot;: &quot;51601fdb-db7c-4b3f-862e-da1154e4ae96&quot;,
        &quot;type&quot;: &quot;PREVIOUS_VERSION&quot;
    },
    {
        &quot;target&quot;: &quot;51c77087-74e2-449f-9def-00acd5e2c944&quot;,
        &quot;type&quot;: &quot;CONTEXT&quot;
    }
],
&quot;data&quot;: {
    &quot;customData&quot;: [{
            &quot;value&quot;: &quot;ArtC2&quot;,
            &quot;key&quot;: &quot;name&quot;
        },
        {
            &quot;value&quot;: 53,
            &quot;key&quot;: &quot;iteration&quot;
        }
    ],
    &quot;fileInformation&quot;: [{
            &quot;extension&quot;: &quot;jar&quot;,
            &quot;classifier&quot;: &quot;debug&quot;
        },
        {
            &quot;extension&quot;: &quot;&quot;,
            &quot;classifier&quot;: &quot;test&quot;
        },
        {
            &quot;extension&quot;: &quot;exe&quot;,
            &quot;classifier&quot;: &quot;&quot;
        }
    ],
    &quot;gav&quot;: {
        &quot;version&quot;: &quot;1.53.0&quot;,
        &quot;artifactId&quot;: &quot;sub-system&quot;,
        &quot;groupId&quot;: &quot;com.mycompany.myproduct&quot;
    }
}
}
</pre></div></div>

<p>When this message is received at EI, processing begins for possible aggregation and notification. In the next step rules object for the message is extracted. The rules object is a set of rules in JSON format that helps extract required information from an event by using JMESPath API (for more information about the EI rules follow this <a class="externalLink" href="https://github.com/eiffel-community/eiffel-intelligence/blob/master/wiki/markdown/Rules.md">link</a>). From the rules object, &#x201c;IdentifyRules&#x201d; is extracted which is a JMESPath identifier of ids and will be used to search for all existing aggregated objects linked to the event under process. Here it should be noted that rules object path is configured in the application.properties file as &#x201c;rules.path&#x201d;.</p>
<p><b>Rule object extracted from the event under consideration:</b></p>

<div>
<div>
<pre class="source">{
&quot;TemplateName&quot;: &quot;ARTIFACT_1&quot;,
&quot;Type&quot;: &quot;EiffelArtifactCreatedEvent&quot;,
&quot;TypeRule&quot;: &quot;meta.type&quot;,
&quot;IdRule&quot;: &quot;meta.id&quot;,
&quot;StartEvent&quot;: &quot;YES&quot;,
&quot;IdentifyRules&quot;: &quot;[meta.id]&quot;,
&quot;MatchIdRules&quot;: {
    &quot;_id&quot;: &quot;%IdentifyRules_objid%&quot;
},
&quot;ExtractionRules&quot;: &quot;{ id : meta.id, type : meta.type, time : meta.time, gav : data.gav, fileInformation : data.fileInformation, buildCommand : data.buildCommand }&quot;,
&quot;DownstreamIdentifyRules&quot;: &quot;links | [?type=='COMPOSITION'].target&quot;,
&quot;DownstreamMergeRules&quot;: &quot;{\&quot;externalComposition\&quot;:{\&quot;eventId\&quot;:%IdentifyRules%}}&quot;,
&quot;DownstreamExtractionRules&quot;: &quot;{artifacts: [{id : meta.id}]}&quot;,
&quot;HistoryIdentifyRules&quot;: &quot;links | [?type=='COMPOSITION'].target&quot;,
&quot;HistoryExtractionRules&quot;: &quot;{id : meta.id, gav : data.gav, fileInformation : data.fileInformation}&quot;,
&quot;HistoryPathRules&quot;: &quot;{artifacts: [{id: meta.id}]}&quot;,
&quot;ProcessRules&quot;: null,
&quot;ProcessFunction&quot;: null
}
</pre></div></div>

<p>If no event-linked aggregated object is found, then next step is to check whether the given event is a &#x201c;start event&#x201d;. It should be clear that, term &#x201c;start event&#x201d; means that the event might be starting a new flow and therefore, a new aggregated object may be created out of this. If the current event is not a &#x201c;start event&#x201d; then it is stored in the database. The name of the collection is configured in the application.properties file as &#x201c;waitlist.collection.name&#x201d;. The event is stored with the aim that if an aggregated object is created later with links to this specific event then it can be merged with that object. The event storage life time is set in the properties file as &#x201c;waitlist.collection.ttlValue&#x201d;.</p>
<p>Otherwise, If the event is a start event (as is the current event) then the next step is information extraction from the event and adding into the aggregated object. It should be noted that this event has no links to any aggregated object. However, as it is a start event so a new aggregated object is created by extracting information from this event.</p>
<p><b>Information Extraction from an Event:</b> In this step, information from a given event is extracted. This information will then be added into a relevant aggregated object. This is what the term aggregation comes from. What information is extracted from a given event is encoded in the extraction rules. Extraction rules are represented in the rules object with a key named &#x201c;ExtractionRules&#x201d;. For example, for the current event and rule object, following information will be extracted:</p>

<div>
<div>
<pre class="source">{
&quot;id&quot;: &quot;ccce572c-c364-441e-abc9-b62fed080ca2&quot;,
&quot;type&quot;: &quot;EiffelArtifactCreatedEvent&quot;,
&quot;time&quot;: 1473177136433,
&quot;gav&quot;: {
    &quot;version&quot;: &quot;1.53.0&quot;,
    &quot;artifactId&quot;: &quot;sub-system&quot;,
    &quot;groupId&quot;: &quot;com.mycompany.myproduct&quot;
},
&quot;fileInformation&quot;: [{
    &quot;extension&quot;: &quot;jar&quot;,
    &quot;classifier&quot;: &quot;debug&quot;
}, {
    &quot;extension&quot;: &quot;&quot;,
    &quot;classifier&quot;: &quot;test&quot;
}, {
    &quot;extension&quot;: &quot;exe&quot;,
    &quot;classifier&quot;: &quot;&quot;
}],
&quot;buildCommand&quot;: null
}
</pre></div></div>

<p>Once the information extraction is complete, the next processing steps are different for start events (an event with no linked aggregated object) and events with link to an associated aggregated object. For start event, an object is created out of the extracted content and inserted into the database, with a name configured in the properties file as &#x201c;aggregated.collection.name&#x201d;. The next step is to query the database for all the upstream linked objects for this event. Then each of the linked object is processed individually. For each object, its rule object field &#x201c;HistoryExtractionRules&#x201d; is used to extract contents from it and merge with the aggregated object. More about the &#x201c;HistoryExtractionRules&#x201d; can be found <a class="externalLink" href="https://github.com/eiffel-community/eiffel-intelligence/blob/master/wiki/markdown/Rules.md">here</a>. Finally, the modified aggregated object is updated in the database.</p>
<p>On the other hand, If the event is linked to aggregated object(s) then each of the aggregated object is processed together with this event. The contents of the event to be merged into the aggregated object are extracted and added to the aggregated object using &#x201c;MergeResolverRules&#x201d;. More about &#x201c;MergeResolverRules&#x201d; can be found <a class="externalLink" href="https://github.com/eiffel-community/eiffel-intelligence/blob/master/wiki/markdown/Rules.md">here</a>. Next, &#x201c;ProcessRules&#x201d; (if exist) are applied on the aggregated object and the resulting modified aggregated object is updated in the database.</p>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                          
                </div>

        
                </div>
    </footer>
        </body>
</html>
