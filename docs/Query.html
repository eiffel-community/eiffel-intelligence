<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 at 2018-12-11 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20181211" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Eiffel Intelligence &#x2013; Query</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.5.min.js"></script>

          
                      </head>
        <body class="topBarEnabled">
          
                
                    
                

    <div id="topbar" class="navbar navbar-fixed-top navbar-inverse">
      <div class="navbar-inner">
                <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
                
                                                                                                    <a class="brand" href="./" >

                                
                                    Eiffel Intelligence
                
                </a>
                    
                                <ul class="nav">
                          <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Overview <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="index.html"  title="Home">Home</a>
</li>
                  
                      <li>      <a href="Configuration.html"  title="Configuration">Configuration</a>
</li>
                  
                      <li>      <a href="Running-Eiffel-Intelligence.html"  title="Running Eiffel Intelligence">Running Eiffel Intelligence</a>
</li>
                  
                      <li class="dropdown-submenu">
                                      <a href="REST-API.html"  title="REST API">REST API</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="Query.html"  title="Query">Query</a>
</li>
                                  <li>      <a href="Running-rules-on-objects.html"  title="Running rules on objects">Running rules on objects</a>
</li>
                                  <li>      <a href="Authentication.html"  title="Authentication">Authentication</a>
</li>
                                  <li>      <a href="Subscription-API.html"  title="Subscriptions">Subscriptions</a>
</li>
                                  <li>      <a href="Download-Files.html"  title="Download files">Download files</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="Subscriptions.html"  title="Subscriptions">Subscriptions</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="REST-POST-notification.html"  title="REST POST notification">REST POST notification</a>
</li>
                                  <li>      <a href="Email-notification.html"  title="Email notification">Email notification</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="Rules.html"  title="Rules">Rules</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="MergeResolverRules.html"  title="Merge Resolver Rules">Merge Resolver Rules</a>
</li>
                                  <li>      <a href="History-rules.html"  title="History Rules">History Rules</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="Step-by-Step-Aggregation.html"  title="Step-by-step aggregation">Step-by-step aggregation</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="ArtifactCreatedEvent-aggregation.html"  title="EiffelArtifactCreatedEvent aggregation">EiffelArtifactCreatedEvent aggregation</a>
</li>
                                  <li>      <a href="EiffelTestCaseTriggeredEvent-Aggregation.html"  title="EiffelTestCaseTriggeredEvent aggregation">EiffelTestCaseTriggeredEvent aggregation</a>
</li>
                                  <li>      <a href="EiffelTestCaseStartedEvent-aggregation.html"  title="EiffelTestCaseStartedEvent aggregation">EiffelTestCaseStartedEvent aggregation</a>
</li>
                                  <li>      <a href="EiffelTestCaseFinishedEvent-aggregation.html"  title="EiffelTestCaseFinishedEvent aggregation">EiffelTestCaseFinishedEvent aggregation</a>
</li>
                                  <li>      <a href="EiffelArtifactPublishedEvent-Aggregation.html"  title="EiffelArtifactPublishedEvent aggregation">EiffelArtifactPublishedEvent aggregation</a>
</li>
                                  <li>      <a href="EiffelConfidenceLevelModifiedEvent-Aggregation.html"  title="EiffelConfidenceLevelModifiedEvent">EiffelConfidenceLevelModifiedEvent</a>
</li>
                                  <li>      <a href="Step-by-Step-Subscription-Notification.html"  title="Step-by-step subscription notification">Step-by-step subscription notification</a>
</li>
                              </ul>
            </li>
                  
                      <li>      <a href="Known-limitations.html"  title="Known limitations">Known limitations</a>
</li>
                          </ul>
      </li>
                  </ul>
          
          
          
                   
                      </div>
          
        </div>
      </div>
    </div>
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Eiffel Intelligence</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                              <li class="">
                    <a href="index.html" title="Home">
        Home</a>
                    <span class="divider">-</span>
      </li>
        <li class="active ">Query</li>
        
              
                  <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2018-12-11</li>
              <li id="projectVersion" class="pull-right">
                    Version: 0.0.18
        </li>
            
                            </ul>
      </div>

                  
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                    <li class="nav-header">Overview</li>
                              
      <li>
  
                          <a href="index.html" title="Home">
          <span class="none"></span>
        Home</a>
            </li>
                
      <li>
  
                          <a href="Configuration.html" title="Configuration">
          <span class="none"></span>
        Configuration</a>
            </li>
                
      <li>
  
                          <a href="Running-Eiffel-Intelligence.html" title="Running Eiffel Intelligence">
          <span class="none"></span>
        Running Eiffel Intelligence</a>
            </li>
                                                                                                                                                    
      <li>
  
                          <a href="REST-API.html" title="REST API">
          <span class="icon-chevron-down"></span>
        REST API</a>
                    <ul class="nav nav-list">
                    
      <li class="active">
  
            <a href="#"><span class="none"></span>Query</a>
          </li>
                    
      <li>
  
                          <a href="Running-rules-on-objects.html" title="Running rules on objects">
          <span class="none"></span>
        Running rules on objects</a>
            </li>
                    
      <li>
  
                          <a href="Authentication.html" title="Authentication">
          <span class="none"></span>
        Authentication</a>
            </li>
                    
      <li>
  
                          <a href="Subscription-API.html" title="Subscriptions">
          <span class="none"></span>
        Subscriptions</a>
            </li>
                    
      <li>
  
                          <a href="Download-Files.html" title="Download files">
          <span class="none"></span>
        Download files</a>
            </li>
              </ul>
        </li>
                                                                                    
      <li>
  
                          <a href="Subscriptions.html" title="Subscriptions">
          <span class="icon-chevron-right"></span>
        Subscriptions</a>
                  </li>
                                                                                    
      <li>
  
                          <a href="Rules.html" title="Rules">
          <span class="icon-chevron-right"></span>
        Rules</a>
                  </li>
                                                                                                                                                                              
      <li>
  
                          <a href="Step-by-Step-Aggregation.html" title="Step-by-step aggregation">
          <span class="icon-chevron-right"></span>
        Step-by-step aggregation</a>
                  </li>
                
      <li>
  
                          <a href="Known-limitations.html" title="Known limitations">
          <span class="none"></span>
        Known limitations</a>
            </li>
            </ul>
              
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                        
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>Query</h1>
<table border="0" class="table table-striped">
<thead>

<tr class="a">
<th>Method</th>
<th>Endpoint             </th></tr>
</thead><tbody>

<tr class="b">
<td>GET   </td>
<td>/queryAggregatedObject</td></tr>
<tr class="a">
<td>POST   </td>
<td>/query</td></tr>
<tr class="b">
<td>GET   </td>
<td>/queryMissedNotifications</td></tr>
</tbody>
</table>
<div class="section">
<h2><a name="Perform_query_on_created_aggregated_object"></a>Perform query on created aggregated object</h2>

<div>
<div>
<pre class="source">GET /queryAggregatedObject  
</pre></div></div>

<p><b>Query parameters</b>:<br />
ID=&lt;documentID&gt;</p>
<p>Examples of this endpoint using curl</p>

<div>
<div>
<pre class="source">curl -X GET -H &quot;Content-type: application/json&quot;  http://localhost:8090/queryAggregatedObject?ID=6acc3c87-75e0-4b6d-88f5-b1a5d4e62b43
</pre></div></div>
</div>
<div class="section">
<h2><a name="Perform_freestyle_query_on_created_aggregated_object"></a>Perform freestyle query on created aggregated object</h2>
<p>It is possible to query for documents using freestyle queries. These freestyle queries are plain mongoDB queries, you can read more about that <a class="externalLink" href="https://docs.mongodb.com/manual/tutorial/query-documents/">here</a>.</p>

<div>
<div>
<pre class="source">POST /query
</pre></div></div>

<p><b>Body (application/json)</b>:</p>

<div>
<div>
<pre class="source">{  
  &quot;criteria&quot;: &lt;MongoDB query&gt;  
  &quot;options&quot;: &lt;MongoDB query&gt; // This one is optional
  &quot;filter&quot;: &lt;JMESPath expression&gt; // This one is optional
}  
</pre></div></div>

<p>Examples of this endpoint using curl</p>

<div>
<div>
<pre class="source">curl -X POST -H &quot;Content-type: application/json&quot;  --data @Body.json http://localhost:34911/query
</pre></div></div>

<p>Examples of criterias:</p>

<div>
<div>
<pre class="source">// This returns all objects where the object.testCaseExecutions.outcome.id is&quot;TC5&quot;  
// or object.testCaseExecutions.outcome.id is &quot;TC6&quot; and &quot;object.gav.groupId&quot;  
// is &quot;com.mycompany.myproduct&quot;.
 
{
  &quot;criteria&quot;: {
    &quot;$or&quot;: [
      {
        &quot;object.testCaseExecutions.outcome.id&quot;:&quot;TC5&quot;
      }, {
        &quot;object.testCaseExecutions.outcome.id&quot;:&quot;TC6&quot;
      }
    ],
    &quot;object.gav.groupId&quot;:&quot;com.mycompany.myproduct&quot;
  }
}


// This returns all objects where TC5 succeeded in 
// the array testCaseExecutions and object.gav.groupId is &quot;com.mycompany.myproduct&quot;.
// Options section is optional.

{
  &quot;criteria&quot;: {
    &quot;object.testCaseExecutions&quot;: {
      &quot;$elemMatch&quot;: {
        &quot;outcome.conclusion&quot;: &quot;SUCCESSFUL&quot;,
        &quot;outcome.id&quot;: &quot;TC5&quot;
      }
    }
  },
  &quot;options&quot;: {
    &quot;object.gav.groupId&quot;: &quot;com.mycompany.myproduct&quot;
  }
}


// This returns all objects where TC5 succeeded 
// and are related to JIRA ticket JIRA-1234
{
    &quot;criteria&quot;: {   
         &quot;object.testCaseExecutions&quot;: {
             &quot;$elemMatch&quot;: {
                 &quot;outcome.conclusion&quot;: &quot;SUCCESSFUL&quot;,
                 &quot;outcome.id&quot;: &quot;TC5&quot;
             }
         },
         &quot;$where&quot; : &quot;function() {
             var searchKey = 'id';
             var value = 'JIRA-1234';        
             return searchInObj(obj);
             function searchInObj(obj){                            
                 for (var k in obj){           
                     if (obj[k] == value &amp;&amp; k == searchKey) {                     
                         return true;                        
                     }
          
                     if (isObject(obj[k]) &amp;&amp; obj[k] !== null) {              
                         if (searchInObj(obj[k])) {
                             return true;
                         }
                     }          
                 }                         
                 return false;
             }   
         }&quot;     
    }
}
</pre></div></div>

<p>NOTE: It should be noted that &#x201c;object&#x201d; is a key word.  It is replaced dynamically in the code, and is configured in the application.properties file. e.g., in string &#x201c;object.testCaseExecutions.outcome.id&#x201d;, substring &#x201c;object&#x201d; is a key word.</p></div>
<div class="section">
<h2><a name="Example_of_freestyle_query_that_returns_all_aggregated_objects"></a>Example of freestyle query that returns all aggregated objects</h2>
<p>By using a query that contains only empty &#x201c;criteria&#x201d; it is possible to return all aggregated objects from the database. The aggregated objects will be returned from specific collection (which name is defined by property aggregated.collection.name) that is stored in specific database (which name is defined by property spring.data.mongodb.database). All properties can be found in <a class="externalLink" href="https://github.com/Ericsson/eiffel-intelligence/blob/master/src/main/resources/application.properties">application&#x2019;s properties</a>.</p>
<p>Example:</p>

<div>
<div>
<pre class="source">{
  &quot;criteria&quot;: {}
}
</pre></div></div>
</div>
<div class="section">
<h2><a name="Query_an_aggregated_object_and_filter_it_with_specific_key"></a>Query an aggregated object and filter it with specific key</h2>
<p>It is possible to filter the object and return only values with specific key or path. To do this, it is required to add filter condition to the json body. The parameter of filter condition is a JMESPath expression, you can read more about that <a class="externalLink" href="http://jmespath.org/tutorial.html#pipe-expressions">here</a>.</p>
<p>Example:</p>

<div>
<div>
<pre class="source">// This match an object in the same way as in the previous example. And then filter 
// it and returns eventId that has a path &quot;aggregatedObject.publications[0].eventId&quot;. 

{
  &quot;criteria&quot;: {
    &quot;object.testCaseExecutions&quot;: {
      &quot;$elemMatch&quot;: {
        &quot;outcome.conclusion&quot;: &quot;SUCCESSFUL&quot;,
        &quot;outcome.id&quot;: &quot;TC5&quot;
      }
    }
  },
  &quot;options&quot;: {
    &quot;object.gav.groupId&quot;: &quot;com.mycompany.myproduct&quot;
  },
  &quot;filter&quot; : &quot;aggregatedObject.publications[0].eventId&quot;
}
</pre></div></div>

<p>To filter with only the key or the partial path, it is required to use &#x201c;incomplete_path_filter(@, &#x2018;some key&#x2019;)&#x201d;.</p>
<p>Example:</p>

<div>
<div>
<pre class="source">// This finds all objects where groupId is &quot;com.mycompany.myproduct&quot;, artifactId is 
// &quot;sub-system&quot; and version is &quot;1.1.0&quot;. Then it filters those objects and returns 
// all values that has &quot;svnIdentifier&quot; as a key. 

{
  &quot;criteria&quot;: {
     &quot;object.gav.groupId&quot;:&quot;com.mycompany.myproduct&quot;,
     &quot;object.gav.artifactId&quot;:&quot;sub-system&quot;,
     &quot;object.gav.version&quot;:&quot;1.1.0&quot;
  },
  &quot;filter&quot; : &quot;incomplete_path_filter(@, 'svnIdentifier')&quot;
}
</pre></div></div>

<p>As the filter functionality takes a plain jmespath expression it can be a more complex expression aswell. In the case below we retrieve all aggregated objects that contains a certain commit using the criteria(MongoDB query) and then filter out which confidence levels the artifact has succeeded on. NOTE that the Mongo DB query aswell as the jmespath expression needs to be on the same line as json cannot handle multilines inside a string. Although some tools such as curl will automatically minimize.</p>
<p>Example</p>

<div>
<div>
<pre class="source">{
    &quot;criteria&quot;: {
        &quot;$where&quot;: &quot;function(){ var searchKey = 'id'; var value = 'JIRA-1234'; return searchInObj(obj); function searchInObj(obj){ for (var k in obj){ if (obj[k] == value &amp;&amp; k == searchKey) { return true;  } if (isObject(obj[k]) &amp;&amp; obj[k] !== null) { if (searchInObj(obj[k])) { return true;}}} return false; }}&quot;
    },
    &quot;filter&quot;: &quot;{id: aggregatedObject.id, artifactGav:aggregatedObject.gav, confidenceLevels:aggregatedObject.confidenceLevels[?value=='SUCCESS'].{name: name, value: value}}&quot;
}
</pre></div></div>
</div>
<div class="section">
<h2><a name="Query_missed_notifications"></a>Query missed notifications</h2>

<div>
<div>
<pre class="source">GET /queryMissedNotifications  
</pre></div></div>

<p><b>Query parameters</b>:<br />
SubscriptionName=&lt;Subscription Name/Subscription ID&gt;</p>
<p>Examples of this endpoint using curl</p>

<div>
<div>
<pre class="source">curl -X GET -H &quot;Content-type: applocalhost:39835/queryMissedNotifications?SubscriptionName=Subscription_1
</pre></div></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                          
                </div>

        
                </div>
    </footer>
        </body>
</html>
