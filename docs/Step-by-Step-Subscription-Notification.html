<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 at 2018-12-11 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20181211" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Eiffel Intelligence &#x2013; Step By Step Subscription Notification</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.5.min.js"></script>

          
                      </head>
        <body class="topBarEnabled">
          
                
                    
                

    <div id="topbar" class="navbar navbar-fixed-top navbar-inverse">
      <div class="navbar-inner">
                <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
                
                                                                                                    <a class="brand" href="./" >

                                
                                    Eiffel Intelligence
                
                </a>
                    
                                <ul class="nav">
                          <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Overview <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="index.html"  title="Home">Home</a>
</li>
                  
                      <li>      <a href="Configuration.html"  title="Configuration">Configuration</a>
</li>
                  
                      <li>      <a href="Running-Eiffel-Intelligence.html"  title="Running Eiffel Intelligence">Running Eiffel Intelligence</a>
</li>
                  
                      <li class="dropdown-submenu">
                                      <a href="REST-API.html"  title="REST API">REST API</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="Query.html"  title="Query">Query</a>
</li>
                                  <li>      <a href="Running-rules-on-objects.html"  title="Running rules on objects">Running rules on objects</a>
</li>
                                  <li>      <a href="Authentication.html"  title="Authentication">Authentication</a>
</li>
                                  <li>      <a href="Subscription-API.html"  title="Subscriptions">Subscriptions</a>
</li>
                                  <li>      <a href="Download-Files.html"  title="Download files">Download files</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="Subscriptions.html"  title="Subscriptions">Subscriptions</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="REST-POST-notification.html"  title="REST POST notification">REST POST notification</a>
</li>
                                  <li>      <a href="Email-notification.html"  title="Email notification">Email notification</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="Rules.html"  title="Rules">Rules</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="MergeResolverRules.html"  title="Merge Resolver Rules">Merge Resolver Rules</a>
</li>
                                  <li>      <a href="History-rules.html"  title="History Rules">History Rules</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="Step-by-Step-Aggregation.html"  title="Step-by-step aggregation">Step-by-step aggregation</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="ArtifactCreatedEvent-aggregation.html"  title="EiffelArtifactCreatedEvent aggregation">EiffelArtifactCreatedEvent aggregation</a>
</li>
                                  <li>      <a href="EiffelTestCaseTriggeredEvent-Aggregation.html"  title="EiffelTestCaseTriggeredEvent aggregation">EiffelTestCaseTriggeredEvent aggregation</a>
</li>
                                  <li>      <a href="EiffelTestCaseStartedEvent-aggregation.html"  title="EiffelTestCaseStartedEvent aggregation">EiffelTestCaseStartedEvent aggregation</a>
</li>
                                  <li>      <a href="EiffelTestCaseFinishedEvent-aggregation.html"  title="EiffelTestCaseFinishedEvent aggregation">EiffelTestCaseFinishedEvent aggregation</a>
</li>
                                  <li>      <a href="EiffelArtifactPublishedEvent-Aggregation.html"  title="EiffelArtifactPublishedEvent aggregation">EiffelArtifactPublishedEvent aggregation</a>
</li>
                                  <li>      <a href="EiffelConfidenceLevelModifiedEvent-Aggregation.html"  title="EiffelConfidenceLevelModifiedEvent">EiffelConfidenceLevelModifiedEvent</a>
</li>
                                  <li>      <a href="Step-by-Step-Subscription-Notification.html"  title="Step-by-step subscription notification">Step-by-step subscription notification</a>
</li>
                              </ul>
            </li>
                  
                      <li>      <a href="Known-limitations.html"  title="Known limitations">Known limitations</a>
</li>
                          </ul>
      </li>
                  </ul>
          
          
          
                   
                      </div>
          
        </div>
      </div>
    </div>
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Eiffel Intelligence</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                              <li class="">
                    <a href="index.html" title="Home">
        Home</a>
                    <span class="divider">-</span>
      </li>
        <li class="active ">Step By Step Subscription Notification</li>
        
              
                  <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2018-12-11</li>
              <li id="projectVersion" class="pull-right">
                    Version: 0.0.18
        </li>
            
                            </ul>
      </div>

                  
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                    <li class="nav-header">Overview</li>
                              
      <li>
  
                          <a href="index.html" title="Home">
          <span class="none"></span>
        Home</a>
            </li>
                
      <li>
  
                          <a href="Configuration.html" title="Configuration">
          <span class="none"></span>
        Configuration</a>
            </li>
                
      <li>
  
                          <a href="Running-Eiffel-Intelligence.html" title="Running Eiffel Intelligence">
          <span class="none"></span>
        Running Eiffel Intelligence</a>
            </li>
                                                                                                                                          
      <li>
  
                          <a href="REST-API.html" title="REST API">
          <span class="icon-chevron-right"></span>
        REST API</a>
                  </li>
                                                                                    
      <li>
  
                          <a href="Subscriptions.html" title="Subscriptions">
          <span class="icon-chevron-right"></span>
        Subscriptions</a>
                  </li>
                                                                                    
      <li>
  
                          <a href="Rules.html" title="Rules">
          <span class="icon-chevron-right"></span>
        Rules</a>
                  </li>
                                                                                                                                                                                        
      <li>
  
                          <a href="Step-by-Step-Aggregation.html" title="Step-by-step aggregation">
          <span class="icon-chevron-down"></span>
        Step-by-step aggregation</a>
                    <ul class="nav nav-list">
                    
      <li>
  
                          <a href="ArtifactCreatedEvent-aggregation.html" title="EiffelArtifactCreatedEvent aggregation">
          <span class="none"></span>
        EiffelArtifactCreatedEvent aggregation</a>
            </li>
                    
      <li>
  
                          <a href="EiffelTestCaseTriggeredEvent-Aggregation.html" title="EiffelTestCaseTriggeredEvent aggregation">
          <span class="none"></span>
        EiffelTestCaseTriggeredEvent aggregation</a>
            </li>
                    
      <li>
  
                          <a href="EiffelTestCaseStartedEvent-aggregation.html" title="EiffelTestCaseStartedEvent aggregation">
          <span class="none"></span>
        EiffelTestCaseStartedEvent aggregation</a>
            </li>
                    
      <li>
  
                          <a href="EiffelTestCaseFinishedEvent-aggregation.html" title="EiffelTestCaseFinishedEvent aggregation">
          <span class="none"></span>
        EiffelTestCaseFinishedEvent aggregation</a>
            </li>
                    
      <li>
  
                          <a href="EiffelArtifactPublishedEvent-Aggregation.html" title="EiffelArtifactPublishedEvent aggregation">
          <span class="none"></span>
        EiffelArtifactPublishedEvent aggregation</a>
            </li>
                    
      <li>
  
                          <a href="EiffelConfidenceLevelModifiedEvent-Aggregation.html" title="EiffelConfidenceLevelModifiedEvent">
          <span class="none"></span>
        EiffelConfidenceLevelModifiedEvent</a>
            </li>
                    
      <li class="active">
  
            <a href="#"><span class="none"></span>Step-by-step subscription notification</a>
          </li>
              </ul>
        </li>
                
      <li>
  
                          <a href="Known-limitations.html" title="Known limitations">
          <span class="none"></span>
        Known limitations</a>
            </li>
            </ul>
              
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                        
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>Step By Step Subscription Notification</h1>
<p>Whenever an aggregated object is created or modified, it is evaluated against all registered subscriptions to find out whether it meets any subscription requirements. If it fulfils a subscription requirement then notification is sent to the subscriber as specified in that subscription. For further explanation, consider the following example: Suppose a subscription is created (as shown below) by a user and then that is stored in the subscription database. More detail about subscription and its fields can be found <a class="externalLink" href="https://github.com/eiffel-community/eiffel-intelligence/blob/master/wiki/markdown/Subscription-API.md">here</a> and <a class="externalLink" href="https://github.com/eiffel-community/eiffel-intelligence-frontend/blob/master/wiki/markdown/Add-Subscription.md">here</a>.</p>

<div>
<div>
<pre class="source">{
    &quot;created&quot;: &quot;2017-07-26&quot;,
    &quot;notificationMeta&quot;: &quot;http://127.0.0.1:3000/ei/test_subscription_rest&quot;,
    &quot;notificationType&quot;: &quot;REST_POST&quot;,
    &quot;restPostBodyMediaType&quot;: &quot;application/x-www-form-urlencoded&quot;,
    &quot;notificationMessageKeyValues&quot;: [{
        &quot;formkey&quot;: &quot;e&quot;,
        &quot;formvalue&quot;: &quot;{parameter: [{ name: 'jsonparams', value : to_string(@) }, { name: 'runpipeline', value : 'mybuildstep' }]}&quot;
    }],
    &quot;repeat&quot;: false,
    &quot;requirements&quot;: [{
            &quot;conditions&quot;: [{
                    &quot;jmespath&quot;: &quot;gav.groupId=='com.mycompany.myproduct'&quot;
                },
                {
                    &quot;jmespath&quot;: &quot;testCaseExecutions[?testCase.conclusion == 'SUCCESSFUL' &amp;&amp; testCase.id=='TC5']&quot;
                }
            ],
            &quot;type&quot;: &quot;ARTIFACT_1&quot;
        },
        {
            &quot;conditions&quot;: [{
                    &quot;jmespath&quot;: &quot;gav.groupId=='com.mycompany.myproduct'&quot;
                },
                {
                    &quot;jmespath&quot;: &quot;testCaseExecutions[?testCaseStartedEventId == '13af4a14-f951-4346-a1ba-624c79f10e98']&quot;
                }
            ],
            &quot;type&quot;: &quot;ARTIFACT_1&quot;
        }
    ],
    &quot;subscriptionName&quot;: &quot;Subscription_Test&quot;,
    &quot;userName&quot;: &quot;ABC&quot; 
}
</pre></div></div>

<p>In this subscription, two requirements are given, where each requirement in turn contains two conditions. As per subscription logic, when all the conditions in any one of the given requirements are met in an aggregated object then the subscription is triggered. Triggering means that the subscriber will be notified with the chosen notification method. It should be noted that conditions are given as JMESPath rule. Let us suppose that an aggregated object, as shown in below, is created:</p>

<div>
<div>
<pre class="source">{
    &quot;fileInformation&quot;: [{
        &quot;extension&quot;: &quot;jar&quot;,
        &quot;classifier&quot;: &quot;&quot;
    }],
    &quot;buildCommand&quot;: null,
    &quot;testCaseExecutions&quot;: [{
        &quot;testCaseFinishEventId&quot;: &quot;11109351-41e0-474a-bc1c-f6e81e58a1c9&quot;,
        &quot;testCaseStartedTime&quot;: 1481875925916,
        &quot;testCaseStartedEventId&quot;: &quot;cb9d64b0-a6e9-4419-8b5d-a650c27c59ca&quot;,
        &quot;testCaseFinishedTime&quot;: 1481875935919,
        &quot;testCase&quot;: {
            &quot;conclusion&quot;: &quot;SUCCESSFUL&quot;,
            &quot;verdict&quot;: &quot;PASSED&quot;,
            &quot;tracker&quot;: &quot;My Other Test Management System&quot;,
            &quot;id&quot;: &quot;TC5&quot;,
            &quot;uri&quot;: &quot;https://other-tm.company.com/testCase/TC5&quot;
        }
    }],
    &quot;id&quot;: &quot;6acc3c87-75e0-4b6d-88f5-b1a5d4e62b43&quot;,
    &quot;time&quot;: 1481875891763,
    &quot;type&quot;: &quot;ARTIFACT_1&quot;,
    &quot;gav&quot;: {
        &quot;groupId&quot;: &quot;com.mycompany.myproduct&quot;,
        &quot;artifactId&quot;: &quot;sub-system&quot;,
        &quot;version&quot;: &quot;1.1.0&quot;
    }
}
</pre></div></div>

<p>When this aggregated object is evaluated against the subscriptions stored in database, then it fulfils our subscription criteria. It can be seen that both conditions of the first requirement are satisfied by the aggregated object. More specifically, in the first condition, JMESPath rule is looking for the gav.groupId==&#x2018;com.mycompany.myproduct&#x2019; and in the second condition it looks for testCaseExecutions.testCase.conclusion == &#x2018;SUCCESSFUL&#x2019; and testCase.id==&#x2018;TC5&#x2019;. Both strings can be found in the aggregated object JSON. Consequently, the process is started to send notification to specified subscriber. For this, &#x2018;notificationType&#x2019; and &#x2018;notificationType&#x2019; field values are extracted from the subscription. In this case the notification need to be send as &#x201c;REST POST&#x201d; at the url <a class="externalLink" href="http://127.0.0.1:3000/ei/test_subscription_rest">http://127.0.0.1:3000/ei/test_subscription_rest</a>. Notification message is prepared as key value pairs. For this case the notification message body look like this:</p>
<p><b>Notification Message:</b></p>

<div>
<div>
<pre class="source">{   
    [
        {
            &quot;fileInformation&quot;: [{
                &quot;extension&quot;: &quot;jar&quot;,
                &quot;classifier&quot;: &quot;&quot;
            }],
            &quot;buildCommand&quot;: null,
            &quot;testCaseExecutions&quot;: [{
                &quot;testCaseFinishEventId&quot;: &quot;11109351-41e0-474a-bc1c-f6e81e58a1c9&quot;,
                &quot;testCaseStartedTime&quot;: 1481875925916,
                &quot;testCaseStartedEventId&quot;: &quot;cb9d64b0-a6e9-4419-8b5d-a650c27c59ca&quot;,
                &quot;testCaseFinishedTime&quot;: 1481875935919,
                &quot;testCase&quot;: {
                    &quot;conclusion&quot;: &quot;SUCCESSFUL&quot;,
                    &quot;verdict&quot;: &quot;PASSED&quot;,
                    &quot;tracker&quot;: &quot;My Other Test Management System&quot;,
                    &quot;id&quot;: &quot;TC5&quot;,
                    &quot;uri&quot;: &quot;https://other-tm.company.com/testCase/TC5&quot;
                }
            }],
            &quot;id&quot;: &quot;6acc3c87-75e0-4b6d-88f5-b1a5d4e62b43&quot;,
            &quot;time&quot;: 1481875891763,
            &quot;type&quot;: &quot;ARTIFACT_1&quot;,
            &quot;gav&quot;: {
                &quot;groupId&quot;: &quot;com.mycompany.myproduct&quot;,
                &quot;artifactId&quot;: &quot;sub-system&quot;,
                &quot;version&quot;: &quot;1.1.0&quot;
            }
        }
    ]
}
</pre></div></div>

<p>If the notification message sending fails, then a fixed number of attempts are made to resend successfully. The number of attempts are specified in the property file as &#x201c;notification.failAttempt&#x201d;. If message sending attempts fails for the specified number of time, then a missed notification is prepared and stored in database. The name of the database is specified in the property file as &#x201c;missedNotificationDataBaseName&#x201d; and collection name as &#x201c;missedNotificationCollectionName&#x201d;. The message is stored in the database for a certain duration before being deleted. This time can be configured in the property file as &#x201c;notification.ttl.value&#x201d;.</p>
<p>If the &#x201c;notificationType&#x201d; of the subscription is &#x201c;MAIL&#x201d; then the notification message is sent to the email address(es) specified in the &#x201c;notificationMeta&#x201d; field. If more than one email address is written, it should be written as a comma separated string. Currently, the subject for email notification is not configurable for individual subscriptions. It is the same for all email notifications and configured in the property file as &#x201c;email.subject&#x201d;.</p>
<p><b>Miss notification in the miss notification database with TTL value:</b></p>

<div>
<div>
<pre class="source">{
    &quot;subscriptionName&quot;: &quot;Subscription_1&quot;,
    &quot;notificationMeta&quot;: &quot;http://127.0.0.1:3000/ei/test_subscription_rest&quot;,
    &quot;Time&quot;: {
        &quot;$date&quot;: &quot;2018-11-10T20:21:56.000Z&quot;
    },
    &quot;AggregatedObject&quot;: {
        &quot;fileInformation&quot;: [{
            &quot;extension&quot;: &quot;jar&quot;,
            &quot;classifier&quot;: &quot;&quot;
        }],
        &quot;buildCommand&quot;: null,
        &quot;testCaseExecutions&quot;: [{
            &quot;testCaseFinishEventId&quot;: &quot;11109351-41e0-474a-bc1c-f6e81e58a1c9&quot;,
            &quot;testCaseStartedTime&quot;: 1481875925916,
            &quot;testCaseStartedEventId&quot;: &quot;cb9d64b0-a6e9-4419-8b5d-a650c27c59ca&quot;,
            &quot;testCaseFinishedTime&quot;: 1481875935919,
            &quot;testCase&quot;: {
                &quot;conclusion&quot;: &quot;SUCCESSFUL&quot;,
                &quot;verdict&quot;: &quot;PASSED&quot;,
                &quot;tracker&quot;: &quot;My Other Test Management System&quot;,
                &quot;id&quot;: &quot;TC5&quot;,
                &quot;uri&quot;: &quot;https://other-tm.company.com/testCase/TC5&quot;
            }
        }],
        &quot;id&quot;: &quot;6acc3c87-75e0-4b6d-88f5-b1a5d4e62b43&quot;,
        &quot;time&quot;: 1481875891763,
        &quot;type&quot;: &quot;ARTIFACT_1&quot;,
        &quot;gav&quot;: {
            &quot;groupId&quot;: &quot;com.mycompany.myproduct&quot;,
            &quot;artifactId&quot;: &quot;sub-system&quot;,
            &quot;version&quot;: &quot;1.1.0&quot;
        }
    }
}
</pre></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                          
                </div>

        
                </div>
    </footer>
        </body>
</html>
